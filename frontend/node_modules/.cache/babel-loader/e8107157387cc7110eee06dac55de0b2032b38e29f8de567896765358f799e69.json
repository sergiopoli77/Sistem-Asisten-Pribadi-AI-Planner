{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\User\\\\AiPlanner\\\\frontend\\\\src\\\\pages\\\\ChatAI.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\nimport \"../assets/chatai.css\";\nimport { db } from \"../config/firebase\";\nimport { ref, push, set, update, remove } from \"firebase/database\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ChatAI = ({\n  initialChat\n}) => {\n  _s();\n  const [input, setInput] = useState(\"\");\n  const [messages, setMessages] = useState([]);\n  const [currentChatId, setCurrentChatId] = useState(null);\n  const [isTyping, setIsTyping] = useState(false);\n  const [sessionId, setSessionId] = useState(null);\n  const chatBoxRef = useRef(null);\n\n  // Ambil username dari localStorage\n  const username = localStorage.getItem(\"username\") || \"guest\";\n\n  // Auto scroll to bottom\n  useEffect(() => {\n    if (chatBoxRef.current) {\n      chatBoxRef.current.scrollTop = chatBoxRef.current.scrollHeight;\n    }\n  }, [messages, isTyping]);\n\n  // Generate session ID saat mount\n  useEffect(() => {\n    // If we have an incoming initialChat (user chose Continue), load it\n    if (initialChat && initialChat.messages && initialChat.messages.length) {\n      setMessages(initialChat.messages);\n      setSessionId(initialChat.sessionId || initialChat.id || `session_${Date.now()}`);\n      setCurrentChatId(initialChat.id || null);\n      return;\n    }\n\n    // otherwise create a new session and show welcome\n    const newSessionId = `session_${Date.now()}`;\n    setSessionId(newSessionId);\n    setMessages([{\n      sender: \"ai\",\n      text: \"üëã Halo! Saya AI Planner Assistant. Saya siap membantu Anda mengatur jadwal, memberikan rekomendasi waktu produktif, dan menjawab pertanyaan seputar perencanaan kegiatan Anda!\",\n      timestamp: new Date().toISOString()\n    }]);\n  }, [initialChat]);\n\n  // Firebase reference untuk chat user\n  const chatRef = ref(db, `chats/${username}`);\n\n  // Simpan chat ke Firebase\n  const saveChatToFirebase = async newMessages => {\n    var _safeMessages;\n    if (!sessionId) return;\n    // Firebase Realtime Database disallows `undefined` values. Ensure we\n    // remove any undefined properties (or replace them) before writing.\n    const sanitizeForFirebase = value => {\n      if (Array.isArray(value)) return value.map(sanitizeForFirebase);\n      if (value && typeof value === \"object\") {\n        const out = {};\n        Object.keys(value).forEach(k => {\n          const v = value[k];\n          if (v === undefined) return; // skip undefined properties\n          out[k] = sanitizeForFirebase(v);\n        });\n        return out;\n      }\n      return value;\n    };\n    const safeMessages = newMessages.map(m => sanitizeForFirebase(m));\n    const chatData = {\n      sessionId,\n      date: new Date().toISOString(),\n      messages: safeMessages,\n      lastMessage: ((_safeMessages = safeMessages[safeMessages.length - 1]) === null || _safeMessages === void 0 ? void 0 : _safeMessages.text) || \"\"\n    };\n\n    // If continuing an existing chat, update that record instead of pushing a new one\n    try {\n      if (currentChatId) {\n        const existingRef = ref(db, `chats/${username}/${currentChatId}`);\n        // update only messages/date/lastMessage to preserve metadata like title\n        await update(existingRef, {\n          messages: chatData.messages,\n          date: chatData.date,\n          lastMessage: chatData.lastMessage\n        });\n        return;\n      }\n    } catch (e) {\n      // fall back to push if update fails\n      console.warn('Failed to update existing chat, falling back to push:', e);\n    }\n    const newChatRef = push(chatRef);\n    set(newChatRef, chatData);\n  };\n\n  // helper: try extract text from backend AI response\n  const extractTextFromAiResponse = data => {\n    if (!data) return '';\n    // if backend returned normalized ai.text\n    if (typeof data.ai === 'string') return data.ai;\n    if (data.ai && typeof data.ai === 'object') {\n      // Common shapes\n      try {\n        var _data$ai$candidates, _data$ai$output, _data$ai$output$, _data$ai$output$$cont, _data$ai$output2, _data$ai$output2$;\n        // v1 style: candidates -> output -> content -> text\n        const cand = (_data$ai$candidates = data.ai.candidates) === null || _data$ai$candidates === void 0 ? void 0 : _data$ai$candidates[0];\n        if (cand) {\n          var _cand$output, _cand$output$, _cand$output$$content, _cand$output$$content2, _cand$output2, _cand$output2$, _cand$output2$$conten;\n          if (typeof cand === 'string') return cand;\n          const text1 = ((_cand$output = cand.output) === null || _cand$output === void 0 ? void 0 : (_cand$output$ = _cand$output[0]) === null || _cand$output$ === void 0 ? void 0 : (_cand$output$$content = _cand$output$.content) === null || _cand$output$$content === void 0 ? void 0 : (_cand$output$$content2 = _cand$output$$content[0]) === null || _cand$output$$content2 === void 0 ? void 0 : _cand$output$$content2.text) || ((_cand$output2 = cand.output) === null || _cand$output2 === void 0 ? void 0 : (_cand$output2$ = _cand$output2[0]) === null || _cand$output2$ === void 0 ? void 0 : (_cand$output2$$conten = _cand$output2$.content) === null || _cand$output2$$conten === void 0 ? void 0 : _cand$output2$$conten.text);\n          if (text1) return text1;\n          const cont = cand.content || cand;\n          if (typeof cont === 'string') return cont;\n        }\n\n        // direct output\n        const out = ((_data$ai$output = data.ai.output) === null || _data$ai$output === void 0 ? void 0 : (_data$ai$output$ = _data$ai$output[0]) === null || _data$ai$output$ === void 0 ? void 0 : (_data$ai$output$$cont = _data$ai$output$.content) === null || _data$ai$output$$cont === void 0 ? void 0 : _data$ai$output$$cont.text) || ((_data$ai$output2 = data.ai.output) === null || _data$ai$output2 === void 0 ? void 0 : (_data$ai$output2$ = _data$ai$output2[0]) === null || _data$ai$output2$ === void 0 ? void 0 : _data$ai$output2$.content);\n        if (out) return out;\n      } catch (e) {\n        // ignore\n      }\n      // fallback to stringified\n      return JSON.stringify(data.ai);\n    }\n    return '';\n  };\n\n  // parse lines like '‚è∞ 08:00 - Belajar React (2 jam)' or '08:00 - Activity (30 menit)'\n  const parseSchedulesFromText = text => {\n    if (!text) return [];\n    const lines = text.split(/\\r?\\n/).map(l => l.trim()).filter(Boolean);\n    const parsed = [];\n    const timeLineRegex = /(?:.*?)(\\d{1,2}:\\d{2})\\s*[-‚Äì‚Äî]\\s*(.+?)(?:\\s*\\(([^)]+)\\))?$/;\n    for (const line of lines) {\n      const m = line.match(timeLineRegex);\n      if (m) {\n        const time = m[1];\n        const activity = m[2].trim();\n        const duration = m[3] ? m[3].trim() : '1 jam';\n        parsed.push({\n          time,\n          activity,\n          duration,\n          priority: 'Sedang'\n        });\n      }\n    }\n    return parsed;\n  };\n\n  // Handle send message (calls backend AI, falls back to local generator)\n  const handleSend = async () => {\n    if (!input.trim()) return;\n    const prompt = input.trim();\n    const userMessage = {\n      sender: 'user',\n      text: prompt,\n      timestamp: new Date().toISOString()\n    };\n    const newMessages = [...messages, userMessage];\n    setMessages(newMessages);\n    setInput('');\n    setIsTyping(true);\n\n    // Try backend AI first\n    try {\n      var _data$ai, _data$ai2, _data$ai2$parsedSched;\n      // send last N messages as history so backend AI can use conversation context\n      const HISTORY_LENGTH = 12;\n      const historyToSend = newMessages.slice(-HISTORY_LENGTH).map(m => ({\n        sender: m.sender,\n        text: m.text\n      }));\n      const resp = await fetch('http://localhost:4000/api/ai/generate-schedule', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          prompt,\n          username,\n          history: historyToSend\n        })\n      });\n      if (!resp.ok) throw new Error(`AI service responded ${resp.status}`);\n      const data = await resp.json();\n      const aiText = (data === null || data === void 0 ? void 0 : (_data$ai = data.ai) === null || _data$ai === void 0 ? void 0 : _data$ai.text) || extractTextFromAiResponse(data) || JSON.stringify(data.ai || data);\n      const parsedSchedules = data !== null && data !== void 0 && (_data$ai2 = data.ai) !== null && _data$ai2 !== void 0 && (_data$ai2$parsedSched = _data$ai2.parsedSchedules) !== null && _data$ai2$parsedSched !== void 0 && _data$ai2$parsedSched.length ? data.ai.parsedSchedules : parseSchedulesFromText(aiText);\n\n      // No auto-add: we always keep manual add option when parsedSchedules exist.\n\n      const aiMessage = {\n        sender: 'ai',\n        text: aiText,\n        timestamp: new Date().toISOString(),\n        // always offer manual add button when parsed schedules exist\n        actions: parsedSchedules.length ? ['Tambahkan ke Jadwal'] : [],\n        parsedSchedules\n      };\n      const finalMessages = [...newMessages, aiMessage];\n      setMessages(finalMessages);\n      setIsTyping(false);\n\n      // Save chat to Firebase\n      saveChatToFirebase(finalMessages);\n\n      // NOTE: we intentionally DO NOT auto-save schedules anymore.\n      // The AI will always show a 'Tambahkan ke Jadwal' button when parsedSchedules exist.\n    } catch (err) {\n      console.warn('AI backend error:', err);\n      const errorText = '‚ö†Ô∏è Maaf, layanan AI sedang bermasalah. Silakan coba lagi beberapa saat.';\n      const aiMessage = {\n        sender: 'ai',\n        text: errorText,\n        timestamp: new Date().toISOString(),\n        actions: [],\n        parsedSchedules: []\n      };\n      const finalMessages = [...newMessages, aiMessage];\n      setMessages(finalMessages);\n      setIsTyping(false);\n      // Save the chat containing the error message so user has context\n      saveChatToFirebase(finalMessages);\n    }\n  };\n\n  // Generate AI Response dengan konteks lebih baik\n  // NOTE: generateAiResponse removed - using pure AI backend. Local fallback responses were removed.\n\n  // Simpan jadwal AI ke Firebase\n  const saveSchedulesToFirebase = schedules => {\n    const scheduleRef = ref(db, `schedules/${username}`);\n    const today = new Date().toISOString().split(\"T\")[0];\n    schedules.forEach(item => {\n      const scheduleData = {\n        kegiatan: item.activity,\n        tanggal: today,\n        waktuMulai: item.time,\n        waktuSelesai: calculateEndTime(item.time, item.duration),\n        lokasi: \"Tidak ditentukan\",\n        prioritas: item.priority || \"Sedang\",\n        catatan: \"Dibuat oleh AI Assistant\",\n        status: \"Belum Dilaksanakan\",\n        createdAt: new Date().toISOString(),\n        createdBy: \"AI\"\n      };\n      const newRef = push(scheduleRef);\n      set(newRef, scheduleData);\n    });\n  };\n\n  // Hitung waktu selesai\n  const calculateEndTime = (startTime, duration) => {\n    const [hours, minutes] = startTime.split(\":\").map(Number);\n    const durationMinutes = parseDuration(duration);\n    const totalMinutes = hours * 60 + minutes + durationMinutes;\n    const endHours = Math.floor(totalMinutes / 60) % 24;\n    const endMinutes = totalMinutes % 60;\n    return `${String(endHours).padStart(2, \"0\")}:${String(endMinutes).padStart(2, \"0\")}`;\n  };\n\n  // Parse duration string\n  const parseDuration = duration => {\n    if (duration.includes(\"jam\")) {\n      const hours = parseFloat(duration);\n      return hours * 60;\n    }\n    if (duration.includes(\"menit\")) {\n      return parseFloat(duration);\n    }\n    return 60; // default 1 jam\n  };\n\n  // Format timestamp\n  const formatTime = timestamp => {\n    const date = new Date(timestamp);\n    return date.toLocaleTimeString(\"id-ID\", {\n      hour: \"2-digit\",\n      minute: \"2-digit\"\n    });\n  };\n\n  // Quick suggestions\n  const quickSuggestions = [\"Buatkan jadwal belajar\", \"Rekomendasi waktu olahraga\", \"Tips produktif\", \"Jadwal meeting\"];\n  const handleQuickSuggestion = suggestion => {\n    setInput(suggestion);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-ai-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-header-content\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-header-icon\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ai-avatar\",\n            children: \"\\uD83E\\uDD16\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 294,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"status-indicator\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-header-text\",\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            children: \"AI Planner Assistant\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"chat-subtitle\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"status-dot\",\n              children: \"\\u25CF\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 300,\n              columnNumber: 15\n            }, this), \" Online - Siap membantu Anda\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 299,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-stats\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"stat-item\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"stat-icon\",\n            children: \"\\uD83D\\uDCAC\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 306,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"stat-value\",\n            children: messages.length\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 307,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"stat-label\",\n            children: \"Pesan\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 305,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"stat-item stat-action\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn-clear-chat\",\n            onClick: async () => {\n              if (!messages || messages.length === 0) return;\n              const ok = window.confirm('Hapus percakapan saat ini? Ini akan mengosongkan chat pada tampilan.');\n              if (!ok) return;\n\n              // If this chat was persisted remotely, remove it so it doesn't reappear\n              if (currentChatId) {\n                try {\n                  const existingRef = ref(db, `chats/${username}/${currentChatId}`);\n                  await remove(existingRef);\n                } catch (e) {\n                  console.warn('Failed to remove existing chat from Firebase:', e);\n                  // proceed with local reset even if remote delete fails\n                }\n              }\n\n              // reset chat locally\n              const newSessionId = `session_${Date.now()}`;\n              setSessionId(newSessionId);\n              setCurrentChatId(null);\n              setMessages([{\n                sender: 'ai',\n                text: 'üëã Halo! Saya AI Planner Assistant. Saya siap membantu Anda mengatur jadwal dan menjawab pertanyaan Anda.',\n                timestamp: new Date().toISOString()\n              }]);\n            },\n            title: \"Clear conversation\",\n            children: \"Clear\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 7\n    }, this), messages.length <= 2 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"quick-suggestions\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"suggestions-title\",\n        children: \"\\uD83D\\uDCA1 Coba tanyakan:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 353,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"suggestions-grid\",\n        children: quickSuggestions.map((suggestion, index) => /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"suggestion-chip\",\n          onClick: () => handleQuickSuggestion(suggestion),\n          children: suggestion\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 356,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 352,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-box\",\n      ref: chatBoxRef,\n      children: [messages.map((msg, msgIndex) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `chat-message ${msg.sender}`,\n        children: [msg.sender === \"ai\" && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"message-avatar\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bot-icon\",\n            children: \"\\uD83E\\uDD16\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 374,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 373,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"message-content\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"message-bubble\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"message-text\",\n              children: msg.text.split(\"\\n\").map((line, i) => /*#__PURE__*/_jsxDEV(React.Fragment, {\n                children: [line, i < msg.text.split(\"\\n\").length - 1 && /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 384,\n                  columnNumber: 63\n                }, this)]\n              }, i, true, {\n                fileName: _jsxFileName,\n                lineNumber: 382,\n                columnNumber: 21\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 380,\n              columnNumber: 17\n            }, this), msg.actions && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"message-actions\",\n              children: msg.actions.map((action, actIndex) => {\n                if (action === 'Tambahkan ke Jadwal') {\n                  return /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"action-btn\",\n                    onClick: () => {\n                      const parsed = msg.parsedSchedules || [];\n                      if (!parsed.length) {\n                        alert('Tidak ada jadwal terdeteksi untuk ditambahkan.');\n                        return;\n                      }\n                      // save schedules to Firebase\n                      saveSchedulesToFirebase(parsed);\n\n                      // update the message to remove the action and add confirmation\n                      setMessages(prev => {\n                        const cp = [...prev];\n                        const target = {\n                          ...(cp[msgIndex] || {})\n                        };\n                        target.actions = [];\n                        target.text = (target.text || '') + '\\n\\n‚úÖ Jadwal berhasil ditambahkan. Cek menu Jadwal.';\n                        cp[msgIndex] = target;\n                        // persist updated chat\n                        try {\n                          saveChatToFirebase(cp);\n                        } catch (e) {/* ignore */}\n                        return cp;\n                      });\n                      alert('‚úÖ Jadwal berhasil ditambahkan. Cek menu Jadwal.');\n                    },\n                    children: action\n                  }, actIndex, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 394,\n                    columnNumber: 27\n                  }, this);\n                }\n                return /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"action-btn\",\n                  children: action\n                }, actIndex, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 427,\n                  columnNumber: 25\n                }, this);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 390,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 379,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"message-time\",\n            children: formatTime(msg.timestamp)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 435,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 378,\n          columnNumber: 13\n        }, this), msg.sender === \"user\" && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"message-avatar user-avatar\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"user-icon\",\n            children: username.charAt(0).toUpperCase()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 440,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 439,\n          columnNumber: 15\n        }, this)]\n      }, msgIndex, true, {\n        fileName: _jsxFileName,\n        lineNumber: 371,\n        columnNumber: 11\n      }, this)), isTyping && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-message ai\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"message-avatar\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bot-icon\",\n            children: \"\\uD83E\\uDD16\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 451,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 450,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"message-content\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"message-bubble typing-indicator\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"typing-dots\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 456,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 457,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 458,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 455,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 454,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 453,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 449,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 369,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-input-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"input-wrapper\",\n        children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n          className: \"chat-input\",\n          placeholder: \"\\uD83D\\uDCAC Tanyakan sesuatu pada AI Assistant...\",\n          value: input,\n          onChange: e => setInput(e.target.value),\n          onKeyDown: e => {\n            if (e.key === \"Enter\" && !e.shiftKey) {\n              e.preventDefault();\n              handleSend();\n            }\n          },\n          rows: \"1\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 469,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: `send-btn ${input.trim() ? \"active\" : \"\"}`,\n          onClick: handleSend,\n          disabled: !input.trim(),\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            width: \"20\",\n            height: \"20\",\n            viewBox: \"0 0 24 24\",\n            fill: \"currentColor\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              d: \"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 488,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 487,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 482,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 468,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"input-hint\",\n        children: [\"Tekan \", /*#__PURE__*/_jsxDEV(\"kbd\", {\n          children: \"Enter\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 493,\n          columnNumber: 17\n        }, this), \" untuk kirim \\u2022 \", /*#__PURE__*/_jsxDEV(\"kbd\", {\n          children: \"Shift + Enter\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 493,\n          columnNumber: 48\n        }, this), \" untuk baris baru\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 492,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 467,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 289,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatAI, \"JQSgCPox5z4lxeZbGiBm5FSCERM=\");\n_c = ChatAI;\nexport default ChatAI;\nvar _c;\n$RefreshReg$(_c, \"ChatAI\");","map":{"version":3,"names":["React","useState","useEffect","useRef","db","ref","push","set","update","remove","jsxDEV","_jsxDEV","ChatAI","initialChat","_s","input","setInput","messages","setMessages","currentChatId","setCurrentChatId","isTyping","setIsTyping","sessionId","setSessionId","chatBoxRef","username","localStorage","getItem","current","scrollTop","scrollHeight","length","id","Date","now","newSessionId","sender","text","timestamp","toISOString","chatRef","saveChatToFirebase","newMessages","_safeMessages","sanitizeForFirebase","value","Array","isArray","map","out","Object","keys","forEach","k","v","undefined","safeMessages","m","chatData","date","lastMessage","existingRef","e","console","warn","newChatRef","extractTextFromAiResponse","data","ai","_data$ai$candidates","_data$ai$output","_data$ai$output$","_data$ai$output$$cont","_data$ai$output2","_data$ai$output2$","cand","candidates","_cand$output","_cand$output$","_cand$output$$content","_cand$output$$content2","_cand$output2","_cand$output2$","_cand$output2$$conten","text1","output","content","cont","JSON","stringify","parseSchedulesFromText","lines","split","l","trim","filter","Boolean","parsed","timeLineRegex","line","match","time","activity","duration","priority","handleSend","prompt","userMessage","_data$ai","_data$ai2","_data$ai2$parsedSched","HISTORY_LENGTH","historyToSend","slice","resp","fetch","method","headers","body","history","ok","Error","status","json","aiText","parsedSchedules","aiMessage","actions","finalMessages","err","errorText","saveSchedulesToFirebase","schedules","scheduleRef","today","item","scheduleData","kegiatan","tanggal","waktuMulai","waktuSelesai","calculateEndTime","lokasi","prioritas","catatan","createdAt","createdBy","newRef","startTime","hours","minutes","Number","durationMinutes","parseDuration","totalMinutes","endHours","Math","floor","endMinutes","String","padStart","includes","parseFloat","formatTime","toLocaleTimeString","hour","minute","quickSuggestions","handleQuickSuggestion","suggestion","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","window","confirm","title","index","msg","msgIndex","i","Fragment","action","actIndex","alert","prev","cp","target","charAt","toUpperCase","placeholder","onChange","onKeyDown","key","shiftKey","preventDefault","rows","disabled","width","height","viewBox","fill","d","_c","$RefreshReg$"],"sources":["C:/Users/User/AiPlanner/frontend/src/pages/ChatAI.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport \"../assets/chatai.css\";\r\nimport { db } from \"../config/firebase\";\r\nimport { ref, push, set, update, remove } from \"firebase/database\";\r\n\r\nconst ChatAI = ({ initialChat }) => {\r\n  const [input, setInput] = useState(\"\");\r\n  const [messages, setMessages] = useState([]);\r\n  const [currentChatId, setCurrentChatId] = useState(null);\r\n  const [isTyping, setIsTyping] = useState(false);\r\n  const [sessionId, setSessionId] = useState(null);\r\n  const chatBoxRef = useRef(null);\r\n\r\n  // Ambil username dari localStorage\r\n  const username = localStorage.getItem(\"username\") || \"guest\";\r\n\r\n  // Auto scroll to bottom\r\n  useEffect(() => {\r\n    if (chatBoxRef.current) {\r\n      chatBoxRef.current.scrollTop = chatBoxRef.current.scrollHeight;\r\n    }\r\n  }, [messages, isTyping]);\r\n\r\n  // Generate session ID saat mount\r\n  useEffect(() => {\r\n    // If we have an incoming initialChat (user chose Continue), load it\r\n    if (initialChat && initialChat.messages && initialChat.messages.length) {\r\n      setMessages(initialChat.messages);\r\n      setSessionId(initialChat.sessionId || initialChat.id || `session_${Date.now()}`);\r\n      setCurrentChatId(initialChat.id || null);\r\n      return;\r\n    }\r\n\r\n    // otherwise create a new session and show welcome\r\n    const newSessionId = `session_${Date.now()}`;\r\n    setSessionId(newSessionId);\r\n    setMessages([\r\n      {\r\n        sender: \"ai\",\r\n        text: \"üëã Halo! Saya AI Planner Assistant. Saya siap membantu Anda mengatur jadwal, memberikan rekomendasi waktu produktif, dan menjawab pertanyaan seputar perencanaan kegiatan Anda!\",\r\n        timestamp: new Date().toISOString(),\r\n      },\r\n    ]);\r\n  }, [initialChat]);\r\n\r\n  // Firebase reference untuk chat user\r\n  const chatRef = ref(db, `chats/${username}`);\r\n\r\n  // Simpan chat ke Firebase\r\n  const saveChatToFirebase = async (newMessages) => {\r\n    if (!sessionId) return;\r\n    // Firebase Realtime Database disallows `undefined` values. Ensure we\r\n    // remove any undefined properties (or replace them) before writing.\r\n    const sanitizeForFirebase = (value) => {\r\n      if (Array.isArray(value)) return value.map(sanitizeForFirebase);\r\n      if (value && typeof value === \"object\") {\r\n        const out = {};\r\n        Object.keys(value).forEach((k) => {\r\n          const v = value[k];\r\n          if (v === undefined) return; // skip undefined properties\r\n          out[k] = sanitizeForFirebase(v);\r\n        });\r\n        return out;\r\n      }\r\n      return value;\r\n    };\r\n\r\n    const safeMessages = newMessages.map((m) => sanitizeForFirebase(m));\r\n\r\n    const chatData = {\r\n      sessionId,\r\n      date: new Date().toISOString(),\r\n      messages: safeMessages,\r\n      lastMessage: safeMessages[safeMessages.length - 1]?.text || \"\",\r\n    };\r\n\r\n    // If continuing an existing chat, update that record instead of pushing a new one\r\n    try {\r\n      if (currentChatId) {\r\n        const existingRef = ref(db, `chats/${username}/${currentChatId}`);\r\n        // update only messages/date/lastMessage to preserve metadata like title\r\n        await update(existingRef, {\r\n          messages: chatData.messages,\r\n          date: chatData.date,\r\n          lastMessage: chatData.lastMessage,\r\n        });\r\n        return;\r\n      }\r\n    } catch (e) {\r\n      // fall back to push if update fails\r\n      console.warn('Failed to update existing chat, falling back to push:', e);\r\n    }\r\n\r\n    const newChatRef = push(chatRef);\r\n    set(newChatRef, chatData);\r\n  };\r\n\r\n  // helper: try extract text from backend AI response\r\n  const extractTextFromAiResponse = (data) => {\r\n    if (!data) return '';\r\n    // if backend returned normalized ai.text\r\n    if (typeof data.ai === 'string') return data.ai;\r\n    if (data.ai && typeof data.ai === 'object') {\r\n      // Common shapes\r\n      try {\r\n        // v1 style: candidates -> output -> content -> text\r\n        const cand = data.ai.candidates?.[0];\r\n        if (cand) {\r\n          if (typeof cand === 'string') return cand;\r\n          const text1 = cand.output?.[0]?.content?.[0]?.text || cand.output?.[0]?.content?.text;\r\n          if (text1) return text1;\r\n          const cont = cand.content || cand;\r\n          if (typeof cont === 'string') return cont;\r\n        }\r\n\r\n        // direct output\r\n        const out = data.ai.output?.[0]?.content?.text || data.ai.output?.[0]?.content;\r\n        if (out) return out;\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n      // fallback to stringified\r\n      return JSON.stringify(data.ai);\r\n    }\r\n    return '';\r\n  };\r\n\r\n  // parse lines like '‚è∞ 08:00 - Belajar React (2 jam)' or '08:00 - Activity (30 menit)'\r\n  const parseSchedulesFromText = (text) => {\r\n    if (!text) return [];\r\n    const lines = text.split(/\\r?\\n/).map((l) => l.trim()).filter(Boolean);\r\n    const parsed = [];\r\n    const timeLineRegex = /(?:.*?)(\\d{1,2}:\\d{2})\\s*[-‚Äì‚Äî]\\s*(.+?)(?:\\s*\\(([^)]+)\\))?$/;\r\n\r\n    for (const line of lines) {\r\n      const m = line.match(timeLineRegex);\r\n      if (m) {\r\n        const time = m[1];\r\n        const activity = m[2].trim();\r\n        const duration = m[3] ? m[3].trim() : '1 jam';\r\n        parsed.push({ time, activity, duration, priority: 'Sedang' });\r\n      }\r\n    }\r\n    return parsed;\r\n  };\r\n\r\n  // Handle send message (calls backend AI, falls back to local generator)\r\n  const handleSend = async () => {\r\n    if (!input.trim()) return;\r\n\r\n    const prompt = input.trim();\r\n\r\n    const userMessage = {\r\n      sender: 'user',\r\n      text: prompt,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n\r\n    const newMessages = [...messages, userMessage];\r\n    setMessages(newMessages);\r\n    setInput('');\r\n    setIsTyping(true);\r\n\r\n    // Try backend AI first\r\n    try {\r\n      // send last N messages as history so backend AI can use conversation context\r\n      const HISTORY_LENGTH = 12;\r\n      const historyToSend = newMessages.slice(-HISTORY_LENGTH).map((m) => ({ sender: m.sender, text: m.text }));\r\n\r\n      const resp = await fetch('http://localhost:4000/api/ai/generate-schedule', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ prompt, username, history: historyToSend }),\r\n      });\r\n\r\n      if (!resp.ok) throw new Error(`AI service responded ${resp.status}`);\r\n      const data = await resp.json();\r\n\r\n      const aiText = data?.ai?.text || extractTextFromAiResponse(data) || JSON.stringify(data.ai || data);\r\n      const parsedSchedules = data?.ai?.parsedSchedules?.length ? data.ai.parsedSchedules : parseSchedulesFromText(aiText);\r\n\r\n  // No auto-add: we always keep manual add option when parsedSchedules exist.\r\n\r\n      const aiMessage = {\r\n        sender: 'ai',\r\n        text: aiText,\r\n        timestamp: new Date().toISOString(),\r\n        // always offer manual add button when parsed schedules exist\r\n        actions: parsedSchedules.length ? ['Tambahkan ke Jadwal'] : [],\r\n        parsedSchedules,\r\n      };\r\n\r\n      const finalMessages = [...newMessages, aiMessage];\r\n      setMessages(finalMessages);\r\n      setIsTyping(false);\r\n\r\n      // Save chat to Firebase\r\n      saveChatToFirebase(finalMessages);\r\n\r\n      // NOTE: we intentionally DO NOT auto-save schedules anymore.\r\n      // The AI will always show a 'Tambahkan ke Jadwal' button when parsedSchedules exist.\r\n    } catch (err) {\r\n        console.warn('AI backend error:', err);\r\n        const errorText = '‚ö†Ô∏è Maaf, layanan AI sedang bermasalah. Silakan coba lagi beberapa saat.';\r\n        const aiMessage = {\r\n          sender: 'ai',\r\n          text: errorText,\r\n          timestamp: new Date().toISOString(),\r\n          actions: [],\r\n          parsedSchedules: [],\r\n        };\r\n\r\n        const finalMessages = [...newMessages, aiMessage];\r\n        setMessages(finalMessages);\r\n        setIsTyping(false);\r\n        // Save the chat containing the error message so user has context\r\n        saveChatToFirebase(finalMessages);\r\n    }\r\n  };\r\n\r\n  // Generate AI Response dengan konteks lebih baik\r\n  // NOTE: generateAiResponse removed - using pure AI backend. Local fallback responses were removed.\r\n\r\n  // Simpan jadwal AI ke Firebase\r\n  const saveSchedulesToFirebase = (schedules) => {\r\n    const scheduleRef = ref(db, `schedules/${username}`);\r\n    const today = new Date().toISOString().split(\"T\")[0];\r\n\r\n    schedules.forEach((item) => {\r\n      const scheduleData = {\r\n        kegiatan: item.activity,\r\n        tanggal: today,\r\n        waktuMulai: item.time,\r\n        waktuSelesai: calculateEndTime(item.time, item.duration),\r\n        lokasi: \"Tidak ditentukan\",\r\n        prioritas: item.priority || \"Sedang\",\r\n        catatan: \"Dibuat oleh AI Assistant\",\r\n        status: \"Belum Dilaksanakan\",\r\n        createdAt: new Date().toISOString(),\r\n        createdBy: \"AI\",\r\n      };\r\n\r\n      const newRef = push(scheduleRef);\r\n      set(newRef, scheduleData);\r\n    });\r\n  };\r\n\r\n  // Hitung waktu selesai\r\n  const calculateEndTime = (startTime, duration) => {\r\n    const [hours, minutes] = startTime.split(\":\").map(Number);\r\n    const durationMinutes = parseDuration(duration);\r\n    const totalMinutes = hours * 60 + minutes + durationMinutes;\r\n    const endHours = Math.floor(totalMinutes / 60) % 24;\r\n    const endMinutes = totalMinutes % 60;\r\n    return `${String(endHours).padStart(2, \"0\")}:${String(endMinutes).padStart(2, \"0\")}`;\r\n  };\r\n\r\n  // Parse duration string\r\n  const parseDuration = (duration) => {\r\n    if (duration.includes(\"jam\")) {\r\n      const hours = parseFloat(duration);\r\n      return hours * 60;\r\n    }\r\n    if (duration.includes(\"menit\")) {\r\n      return parseFloat(duration);\r\n    }\r\n    return 60; // default 1 jam\r\n  };\r\n\r\n  // Format timestamp\r\n  const formatTime = (timestamp) => {\r\n    const date = new Date(timestamp);\r\n    return date.toLocaleTimeString(\"id-ID\", { hour: \"2-digit\", minute: \"2-digit\" });\r\n  };\r\n\r\n  // Quick suggestions\r\n  const quickSuggestions = [\r\n    \"Buatkan jadwal belajar\",\r\n    \"Rekomendasi waktu olahraga\",\r\n    \"Tips produktif\",\r\n    \"Jadwal meeting\",\r\n  ];\r\n\r\n  const handleQuickSuggestion = (suggestion) => {\r\n    setInput(suggestion);\r\n  };\r\n\r\n  return (\r\n    <div className=\"chat-ai-container\">\r\n      {/* Header */}\r\n      <div className=\"chat-header\">\r\n        <div className=\"chat-header-content\">\r\n          <div className=\"chat-header-icon\">\r\n            <div className=\"ai-avatar\">ü§ñ</div>\r\n            <div className=\"status-indicator\"></div>\r\n          </div>\r\n          <div className=\"chat-header-text\">\r\n            <h1>AI Planner Assistant</h1>\r\n            <p className=\"chat-subtitle\">\r\n              <span className=\"status-dot\">‚óè</span> Online - Siap membantu Anda\r\n            </p>\r\n          </div>\r\n        </div>\r\n        <div className=\"chat-stats\">\r\n          <div className=\"stat-item\">\r\n            <span className=\"stat-icon\">üí¨</span>\r\n            <span className=\"stat-value\">{messages.length}</span>\r\n            <span className=\"stat-label\">Pesan</span>\r\n          </div>\r\n          {/* New Chat button removed per request */}\r\n          <div className=\"stat-item stat-action\">\r\n            <button\r\n              className=\"btn-clear-chat\"\r\n              onClick={async () => {\r\n                  if (!messages || messages.length === 0) return;\r\n                  const ok = window.confirm('Hapus percakapan saat ini? Ini akan mengosongkan chat pada tampilan.');\r\n                  if (!ok) return;\r\n\r\n                  // If this chat was persisted remotely, remove it so it doesn't reappear\r\n                  if (currentChatId) {\r\n                    try {\r\n                      const existingRef = ref(db, `chats/${username}/${currentChatId}`);\r\n                      await remove(existingRef);\r\n                    } catch (e) {\r\n                      console.warn('Failed to remove existing chat from Firebase:', e);\r\n                      // proceed with local reset even if remote delete fails\r\n                    }\r\n                  }\r\n\r\n                  // reset chat locally\r\n                  const newSessionId = `session_${Date.now()}`;\r\n                  setSessionId(newSessionId);\r\n                  setCurrentChatId(null);\r\n                  setMessages([\r\n                    {\r\n                      sender: 'ai',\r\n                      text: 'üëã Halo! Saya AI Planner Assistant. Saya siap membantu Anda mengatur jadwal dan menjawab pertanyaan Anda.',\r\n                      timestamp: new Date().toISOString(),\r\n                    },\r\n                  ]);\r\n                }}\r\n              title=\"Clear conversation\"\r\n            >\r\n              Clear\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Quick Suggestions */}\r\n      {messages.length <= 2 && (\r\n        <div className=\"quick-suggestions\">\r\n          <p className=\"suggestions-title\">üí° Coba tanyakan:</p>\r\n          <div className=\"suggestions-grid\">\r\n            {quickSuggestions.map((suggestion, index) => (\r\n              <button\r\n                key={index}\r\n                className=\"suggestion-chip\"\r\n                onClick={() => handleQuickSuggestion(suggestion)}\r\n              >\r\n                {suggestion}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Chat Box */}\r\n      <div className=\"chat-box\" ref={chatBoxRef}>\r\n        {messages.map((msg, msgIndex) => (\r\n          <div key={msgIndex} className={`chat-message ${msg.sender}`}>\r\n            {msg.sender === \"ai\" && (\r\n              <div className=\"message-avatar\">\r\n                <div className=\"bot-icon\">ü§ñ</div>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"message-content\">\r\n              <div className=\"message-bubble\">\r\n                <p className=\"message-text\">\r\n                  {msg.text.split(\"\\n\").map((line, i) => (\r\n                    <React.Fragment key={i}>\r\n                      {line}\r\n                      {i < msg.text.split(\"\\n\").length - 1 && <br />}\r\n                    </React.Fragment>\r\n                  ))}\r\n                </p>\r\n\r\n                {msg.actions && (\r\n                  <div className=\"message-actions\">\r\n                    {msg.actions.map((action, actIndex) => {\r\n                      if (action === 'Tambahkan ke Jadwal') {\r\n                        return (\r\n                          <button\r\n                            key={actIndex}\r\n                            className=\"action-btn\"\r\n                            onClick={() => {\r\n                              const parsed = msg.parsedSchedules || [];\r\n                              if (!parsed.length) {\r\n                                alert('Tidak ada jadwal terdeteksi untuk ditambahkan.');\r\n                                return;\r\n                              }\r\n                              // save schedules to Firebase\r\n                              saveSchedulesToFirebase(parsed);\r\n\r\n                              // update the message to remove the action and add confirmation\r\n                              setMessages((prev) => {\r\n                                const cp = [...prev];\r\n                                const target = { ...(cp[msgIndex] || {}) };\r\n                                target.actions = [];\r\n                                target.text = (target.text || '') + '\\n\\n‚úÖ Jadwal berhasil ditambahkan. Cek menu Jadwal.';\r\n                                cp[msgIndex] = target;\r\n                                // persist updated chat\r\n                                try { saveChatToFirebase(cp); } catch (e) { /* ignore */ }\r\n                                return cp;\r\n                              });\r\n\r\n                              alert('‚úÖ Jadwal berhasil ditambahkan. Cek menu Jadwal.');\r\n                            }}\r\n                          >\r\n                            {action}\r\n                          </button>\r\n                        );\r\n                      }\r\n\r\n                      return (\r\n                        <button key={actIndex} className=\"action-btn\">\r\n                          {action}\r\n                        </button>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              <span className=\"message-time\">{formatTime(msg.timestamp)}</span>\r\n            </div>\r\n\r\n            {msg.sender === \"user\" && (\r\n              <div className=\"message-avatar user-avatar\">\r\n                <div className=\"user-icon\">\r\n                  {username.charAt(0).toUpperCase()}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ))}\r\n\r\n        {isTyping && (\r\n          <div className=\"chat-message ai\">\r\n            <div className=\"message-avatar\">\r\n              <div className=\"bot-icon\">ü§ñ</div>\r\n            </div>\r\n            <div className=\"message-content\">\r\n              <div className=\"message-bubble typing-indicator\">\r\n                <div className=\"typing-dots\">\r\n                  <span></span>\r\n                  <span></span>\r\n                  <span></span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Input Section */}\r\n      <div className=\"chat-input-section\">\r\n        <div className=\"input-wrapper\">\r\n          <textarea\r\n            className=\"chat-input\"\r\n            placeholder=\"üí¨ Tanyakan sesuatu pada AI Assistant...\"\r\n            value={input}\r\n            onChange={(e) => setInput(e.target.value)}\r\n            onKeyDown={(e) => {\r\n              if (e.key === \"Enter\" && !e.shiftKey) {\r\n                e.preventDefault();\r\n                handleSend();\r\n              }\r\n            }}\r\n            rows=\"1\"\r\n          />\r\n          <button\r\n            className={`send-btn ${input.trim() ? \"active\" : \"\"}`}\r\n            onClick={handleSend}\r\n            disabled={!input.trim()}\r\n          >\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n              <path d=\"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        <p className=\"input-hint\">\r\n          Tekan <kbd>Enter</kbd> untuk kirim ‚Ä¢ <kbd>Shift + Enter</kbd> untuk baris baru\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\nexport default ChatAI;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}