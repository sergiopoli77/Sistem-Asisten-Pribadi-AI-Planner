{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\User\\\\AiPlanner\\\\frontend\\\\src\\\\pages\\\\RiwayatChat.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from \"react\";\nimport { getDatabase, ref, onValue, remove, update } from \"firebase/database\";\nimport \"../assets/Riwayat.css\";\nimport ConfirmModal from \"../components/ConfirmModal\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst RiwayatChat = () => {\n  _s();\n  const [chatList, setChatList] = useState([]);\n  const [selectedChat, setSelectedChat] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [currentUser, setCurrentUser] = useState(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filterDate, setFilterDate] = useState(\"all\");\n  const [editingChatId, setEditingChatId] = useState(null);\n  const [editTitle, setEditTitle] = useState(\"\");\n  const chatViewRef = useRef(null);\n  const [showConfirmDeleteId, setShowConfirmDeleteId] = useState(null);\n  const [showConfirmDeleteAll, setShowConfirmDeleteAll] = useState(false);\n  const db = getDatabase();\n\n  // Ambil username dari localStorage\n  useEffect(() => {\n    try {\n      const u = localStorage.getItem(\"username\");\n      if (u) {\n        setCurrentUser(u);\n      } else {\n        alert(\"Kamu belum login! Silakan masuk terlebih dahulu.\");\n        window.location.href = \"/login\";\n      }\n    } catch (e) {\n      console.warn(\"Gagal membaca localStorage:\", e);\n      window.location.href = \"/login\";\n    }\n  }, []);\n\n  // Ambil riwayat chat\n  useEffect(() => {\n    if (!currentUser) return;\n    const chatRef = ref(db, `chats/${currentUser}`);\n    const unsubscribe = onValue(chatRef, snapshot => {\n      const data = snapshot.val();\n      if (data) {\n        const chats = Object.entries(data).map(([id, value]) => ({\n          id,\n          ...value\n        }));\n\n        // Sort by date (newest first)\n        chats.sort((a, b) => new Date(b.date) - new Date(a.date));\n        setChatList(chats);\n      } else {\n        setChatList([]);\n      }\n      setLoading(false);\n    });\n    return () => unsubscribe();\n  }, [db, currentUser]);\n\n  // Auto scroll to bottom when chat selected\n  useEffect(() => {\n    if (chatViewRef.current) {\n      chatViewRef.current.scrollTop = chatViewRef.current.scrollHeight;\n    }\n  }, [selectedChat]);\n\n  // Handle select chat\n  const handleSelectChat = chat => {\n    setSelectedChat(chat);\n    setEditingChatId(null);\n  };\n\n  // Continue chat: dispatch event so Dashboard can switch to ChatAI with this chat\n  const handleContinueChat = (chat, e) => {\n    if (e) e.stopPropagation();\n    try {\n      // dispatch custom event\n      window.dispatchEvent(new CustomEvent('continueChat', {\n        detail: chat\n      }));\n      // also set a fallback in localStorage in case other tab needs it\n      localStorage.setItem('continueChat', JSON.stringify(chat));\n    } catch (err) {\n      console.warn('Unable to dispatch continueChat event, using localStorage fallback', err);\n      localStorage.setItem('continueChat', JSON.stringify(chat));\n    }\n  };\n\n  // Handle delete chat\n  const handleDeleteChat = (id, e) => {\n    if (e) e.stopPropagation();\n    setShowConfirmDeleteId(id);\n  };\n  const confirmDeleteChat = id => {\n    try {\n      remove(ref(db, `chats/${currentUser}/${id}`));\n    } catch (err) {\n      console.warn('Failed removing chat node:', err);\n    }\n    try {\n      remove(ref(db, `chatHistory/${currentUser}/${id}`));\n    } catch (err) {\n      // ignore\n    }\n    if ((selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.id) === id) setSelectedChat(null);\n    setShowConfirmDeleteId(null);\n  };\n\n  // Handle delete all chats\n  const handleDeleteAll = () => {\n    if (chatList.length === 0) {\n      alert(\"Tidak ada chat untuk dihapus\");\n      return;\n    }\n    const confirmed = window.confirm(`⚠️ PERINGATAN!\\n\\nAnda akan menghapus SEMUA riwayat chat (${chatList.length} percakapan).\\n\\nTindakan ini TIDAK DAPAT dibatalkan!\\n\\nLanjutkan?`);\n    if (confirmed) {\n      setShowConfirmDeleteAll(true);\n    }\n  };\n  const confirmDeleteAll = () => {\n    setShowConfirmDeleteAll(false);\n    // remove everything under chats and chatHistory for this user\n    try {\n      remove(ref(db, `chats/${currentUser}`));\n    } catch (err) {\n      console.warn('Failed to remove chats root:', err);\n      // fallback: remove one-by-one\n      chatList.forEach(chat => {\n        try {\n          remove(ref(db, `chats/${currentUser}/${chat.id}`));\n        } catch (e) {}\n      });\n    }\n    try {\n      remove(ref(db, `chatHistory/${currentUser}`));\n    } catch (err) {\n      console.warn('Failed to remove chatHistory root:', err);\n    }\n    setSelectedChat(null);\n    alert(\"✅ Semua riwayat chat berhasil dihapus!\");\n  };\n\n  // Handle edit chat title\n  const handleEditTitle = chat => {\n    setEditingChatId(chat.id);\n    setEditTitle(chat.title || generateChatTitle(chat));\n  };\n\n  // Save edited title\n  const handleSaveTitle = async chatId => {\n    if (!editTitle.trim()) {\n      alert(\"Judul tidak boleh kosong!\");\n      return;\n    }\n    try {\n      await update(ref(db, `chats/${currentUser}/${chatId}`), {\n        title: editTitle.trim()\n      });\n      setEditingChatId(null);\n    } catch (error) {\n      console.error(\"Error updating title:\", error);\n      alert(\"Gagal mengubah judul!\");\n    }\n  };\n\n  // Generate title from first message\n  const generateChatTitle = chat => {\n    if (chat.messages && chat.messages.length > 0) {\n      const firstUserMessage = chat.messages.find(m => m.sender === \"user\");\n      if (firstUserMessage) {\n        return firstUserMessage.text.substring(0, 40) + \"...\";\n      }\n    }\n    return \"Percakapan tanpa judul\";\n  };\n\n  // Filter chats\n  const filteredChats = chatList.filter(chat => {\n    // Search filter\n    const title = chat.title || generateChatTitle(chat);\n    const matchSearch = title.toLowerCase().includes(searchTerm.toLowerCase());\n\n    // Date filter\n    let matchDate = true;\n    if (filterDate !== \"all\") {\n      const chatDate = new Date(chat.date);\n      const today = new Date();\n      const diffTime = today - chatDate;\n      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\n      if (filterDate === \"today\") {\n        matchDate = diffDays === 0;\n      } else if (filterDate === \"week\") {\n        matchDate = diffDays <= 7;\n      } else if (filterDate === \"month\") {\n        matchDate = diffDays <= 30;\n      }\n    }\n    return matchSearch && matchDate;\n  });\n\n  // Format timestamp\n  const formatTimestamp = timestamp => {\n    if (!timestamp) return \"\";\n    const date = new Date(timestamp);\n    return date.toLocaleString(\"id-ID\", {\n      year: \"numeric\",\n      month: \"long\",\n      day: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\"\n    });\n  };\n\n  // Format relative time\n  const formatRelativeTime = timestamp => {\n    if (!timestamp) return \"\";\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffTime = now - date;\n    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\n    const diffHours = Math.floor(diffTime / (1000 * 60 * 60));\n    const diffMinutes = Math.floor(diffTime / (1000 * 60));\n    if (diffMinutes < 1) return \"Baru saja\";\n    if (diffMinutes < 60) return `${diffMinutes} menit lalu`;\n    if (diffHours < 24) return `${diffHours} jam lalu`;\n    if (diffDays === 1) return \"Kemarin\";\n    if (diffDays < 7) return `${diffDays} hari lalu`;\n    return date.toLocaleDateString(\"id-ID\", {\n      day: \"numeric\",\n      month: \"short\"\n    });\n  };\n\n  // Export chat\n  const handleExportChat = () => {\n    if (!selectedChat) return;\n    const chatText = selectedChat.messages.map(msg => {\n      const sender = msg.sender === \"user\" ? \"Anda\" : \"AI Assistant\";\n      return `[${sender}]: ${msg.text}`;\n    }).join(\"\\n\\n\");\n    const blob = new Blob([chatText], {\n      type: \"text/plain\"\n    });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `chat-${selectedChat.id}.txt`;\n    a.click();\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loading-spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Memuat riwayat chat...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"riwayat-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-sidebar\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"sidebar-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"header-title\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"\\uD83D\\uDCAC Riwayat Chat\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"subtitle\",\n            children: [chatList.length, \" percakapan tersimpan\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 11\n        }, this), chatList.length > 0 && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn-delete-all\",\n          onClick: handleDeleteAll,\n          title: \"Hapus semua chat\",\n          children: \"\\uD83D\\uDDD1\\uFE0F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 279,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"sidebar-controls\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"search-box\",\n          children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n            width: \"18\",\n            height: \"18\",\n            viewBox: \"0 0 24 24\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            strokeWidth: \"2\",\n            children: [/*#__PURE__*/_jsxDEV(\"circle\", {\n              cx: \"11\",\n              cy: \"11\",\n              r: \"8\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 289,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n              d: \"m21 21-4.35-4.35\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 290,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Cari chat...\",\n            value: searchTerm,\n            onChange: e => setSearchTerm(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 292,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          className: \"filter-select\",\n          value: filterDate,\n          onChange: e => setFilterDate(e.target.value),\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"all\",\n            children: \"Semua Waktu\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 305,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"today\",\n            children: \"Hari Ini\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 306,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"week\",\n            children: \"Minggu Ini\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 307,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"month\",\n            children: \"Bulan Ini\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-list\",\n        children: filteredChats.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"empty-state-sidebar\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"empty-icon\",\n            children: \"\\uD83D\\uDCED\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 316,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Tidak ada chat ditemukan\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 317,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 315,\n          columnNumber: 13\n        }, this) : filteredChats.map(chat => {\n          var _chat$lastMessage;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `chat-item ${(selectedChat === null || selectedChat === void 0 ? void 0 : selectedChat.id) === chat.id ? \"active\" : \"\"}`,\n            onClick: () => handleSelectChat(chat),\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-icon-wrapper\",\n              children: /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"chat-icon\",\n                children: \"\\uD83E\\uDD16\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 327,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 326,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-info\",\n              children: [editingChatId === chat.id ? /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                className: \"edit-title-input\",\n                value: editTitle,\n                onChange: e => setEditTitle(e.target.value),\n                onBlur: () => handleSaveTitle(chat.id),\n                onKeyDown: e => {\n                  if (e.key === \"Enter\") handleSaveTitle(chat.id);\n                  if (e.key === \"Escape\") setEditingChatId(null);\n                },\n                autoFocus: true,\n                onClick: e => e.stopPropagation()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 332,\n                columnNumber: 21\n              }, this) : /*#__PURE__*/_jsxDEV(\"h4\", {\n                children: chat.title || generateChatTitle(chat)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 346,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"chat-date\",\n                children: formatRelativeTime(chat.date)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 348,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"chat-preview\",\n                children: [((_chat$lastMessage = chat.lastMessage) === null || _chat$lastMessage === void 0 ? void 0 : _chat$lastMessage.substring(0, 50)) || \"Tidak ada pesan\", \"...\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 349,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 330,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-actions\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"action-btn continue\",\n                onClick: e => {\n                  e.stopPropagation();\n                  handleContinueChat(chat);\n                },\n                title: \"Lanjutkan percakapan\",\n                children: \"\\u25B6\\uFE0F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 355,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"action-btn edit\",\n                onClick: e => {\n                  e.stopPropagation();\n                  handleEditTitle(chat);\n                },\n                title: \"Edit judul\",\n                children: \"\\u270F\\uFE0F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 365,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"action-btn delete\",\n                onClick: e => handleDeleteChat(chat.id, e),\n                title: \"Hapus chat\",\n                children: \"\\uD83D\\uDDD1\\uFE0F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 375,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 354,\n              columnNumber: 17\n            }, this)]\n          }, chat.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 321,\n            columnNumber: 15\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-view\",\n      children: selectedChat ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-view-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"header-info\",\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              children: selectedChat.title || generateChatTitle(selectedChat)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 395,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: formatTimestamp(selectedChat.date)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 396,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 394,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"header-actions\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn-export\",\n              onClick: handleExportChat,\n              title: \"Export chat\",\n              children: \"\\uD83D\\uDCE5 Export\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 399,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn-delete\",\n              onClick: e => handleDeleteChat(selectedChat.id, e),\n              title: \"Hapus chat\",\n              children: \"\\uD83D\\uDDD1\\uFE0F Hapus\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 402,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 398,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 393,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-messages\",\n          ref: chatViewRef,\n          children: selectedChat.messages && selectedChat.messages.length > 0 ? selectedChat.messages.map((msg, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `message-wrapper ${msg.sender === \"user\" ? \"user\" : \"ai\"}`,\n            children: [msg.sender === \"ai\" && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"message-avatar\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"bot-icon\",\n                children: \"\\uD83E\\uDD16\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 421,\n                columnNumber: 25\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 420,\n              columnNumber: 23\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"message-bubble\",\n              children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"message-text\",\n                children: msg.text.split(\"\\n\").map((line, i) => /*#__PURE__*/_jsxDEV(React.Fragment, {\n                  children: [line, i < msg.text.split(\"\\n\").length - 1 && /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 430,\n                    columnNumber: 69\n                  }, this)]\n                }, i, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 428,\n                  columnNumber: 27\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 426,\n                columnNumber: 23\n              }, this), msg.timestamp && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"message-time\",\n                children: new Date(msg.timestamp).toLocaleTimeString(\"id-ID\", {\n                  hour: \"2-digit\",\n                  minute: \"2-digit\"\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 435,\n                columnNumber: 25\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 425,\n              columnNumber: 21\n            }, this), msg.sender === \"user\" && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"message-avatar user-avatar\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"user-icon\",\n                children: currentUser.charAt(0).toUpperCase()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 446,\n                columnNumber: 25\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 445,\n              columnNumber: 23\n            }, this)]\n          }, index, true, {\n            fileName: _jsxFileName,\n            lineNumber: 415,\n            columnNumber: 19\n          }, this)) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"empty-messages\",\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"Tidak ada pesan dalam percakapan ini\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 455,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 454,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 412,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-empty\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"empty-icon-large\",\n          children: \"\\uD83D\\uDCAC\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 462,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Belum ada chat yang dipilih\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 463,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Pilih salah satu percakapan di sebelah kiri untuk melihat isinya\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 464,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 461,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 390,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 268,\n    columnNumber: 5\n  }, this);\n};\n_s(RiwayatChat, \"lT5hmcz6j2FA1VuGAUyvWMjL7+A=\");\n_c = RiwayatChat;\nexport default RiwayatChat;\nvar _c;\n$RefreshReg$(_c, \"RiwayatChat\");","map":{"version":3,"names":["React","useEffect","useState","useRef","getDatabase","ref","onValue","remove","update","ConfirmModal","jsxDEV","_jsxDEV","Fragment","_Fragment","RiwayatChat","_s","chatList","setChatList","selectedChat","setSelectedChat","loading","setLoading","currentUser","setCurrentUser","searchTerm","setSearchTerm","filterDate","setFilterDate","editingChatId","setEditingChatId","editTitle","setEditTitle","chatViewRef","showConfirmDeleteId","setShowConfirmDeleteId","showConfirmDeleteAll","setShowConfirmDeleteAll","db","u","localStorage","getItem","alert","window","location","href","e","console","warn","chatRef","unsubscribe","snapshot","data","val","chats","Object","entries","map","id","value","sort","a","b","Date","date","current","scrollTop","scrollHeight","handleSelectChat","chat","handleContinueChat","stopPropagation","dispatchEvent","CustomEvent","detail","setItem","JSON","stringify","err","handleDeleteChat","confirmDeleteChat","handleDeleteAll","length","confirmed","confirm","confirmDeleteAll","forEach","handleEditTitle","title","generateChatTitle","handleSaveTitle","chatId","trim","error","messages","firstUserMessage","find","m","sender","text","substring","filteredChats","filter","matchSearch","toLowerCase","includes","matchDate","chatDate","today","diffTime","diffDays","Math","floor","formatTimestamp","timestamp","toLocaleString","year","month","day","hour","minute","formatRelativeTime","now","diffHours","diffMinutes","toLocaleDateString","handleExportChat","chatText","msg","join","blob","Blob","type","url","URL","createObjectURL","document","createElement","download","click","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","width","height","viewBox","fill","stroke","strokeWidth","cx","cy","r","d","placeholder","onChange","target","_chat$lastMessage","onBlur","onKeyDown","key","autoFocus","lastMessage","index","split","line","i","toLocaleTimeString","charAt","toUpperCase","_c","$RefreshReg$"],"sources":["C:/Users/User/AiPlanner/frontend/src/pages/RiwayatChat.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\nimport { getDatabase, ref, onValue, remove, update } from \"firebase/database\";\r\nimport \"../assets/Riwayat.css\";\r\nimport ConfirmModal from \"../components/ConfirmModal\";\r\n\r\nconst RiwayatChat = () => {\r\n  const [chatList, setChatList] = useState([]);\r\n  const [selectedChat, setSelectedChat] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [currentUser, setCurrentUser] = useState(null);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n  const [filterDate, setFilterDate] = useState(\"all\");\r\n  const [editingChatId, setEditingChatId] = useState(null);\r\n  const [editTitle, setEditTitle] = useState(\"\");\r\n  const chatViewRef = useRef(null);\r\n  const [showConfirmDeleteId, setShowConfirmDeleteId] = useState(null);\r\n  const [showConfirmDeleteAll, setShowConfirmDeleteAll] = useState(false);\r\n\r\n  const db = getDatabase();\r\n\r\n  // Ambil username dari localStorage\r\n  useEffect(() => {\r\n    try {\r\n      const u = localStorage.getItem(\"username\");\r\n      if (u) {\r\n        setCurrentUser(u);\r\n      } else {\r\n        alert(\"Kamu belum login! Silakan masuk terlebih dahulu.\");\r\n        window.location.href = \"/login\";\r\n      }\r\n    } catch (e) {\r\n      console.warn(\"Gagal membaca localStorage:\", e);\r\n      window.location.href = \"/login\";\r\n    }\r\n  }, []);\r\n\r\n  // Ambil riwayat chat\r\n  useEffect(() => {\r\n    if (!currentUser) return;\r\n\r\n    const chatRef = ref(db, `chats/${currentUser}`);\r\n    const unsubscribe = onValue(chatRef, (snapshot) => {\r\n      const data = snapshot.val();\r\n      if (data) {\r\n        const chats = Object.entries(data).map(([id, value]) => ({\r\n          id,\r\n          ...value,\r\n        }));\r\n\r\n        // Sort by date (newest first)\r\n        chats.sort((a, b) => new Date(b.date) - new Date(a.date));\r\n        setChatList(chats);\r\n      } else {\r\n        setChatList([]);\r\n      }\r\n      setLoading(false);\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [db, currentUser]);\r\n\r\n  // Auto scroll to bottom when chat selected\r\n  useEffect(() => {\r\n    if (chatViewRef.current) {\r\n      chatViewRef.current.scrollTop = chatViewRef.current.scrollHeight;\r\n    }\r\n  }, [selectedChat]);\r\n\r\n  // Handle select chat\r\n  const handleSelectChat = (chat) => {\r\n    setSelectedChat(chat);\r\n    setEditingChatId(null);\r\n  };\r\n\r\n  // Continue chat: dispatch event so Dashboard can switch to ChatAI with this chat\r\n  const handleContinueChat = (chat, e) => {\r\n    if (e) e.stopPropagation();\r\n    try {\r\n      // dispatch custom event\r\n      window.dispatchEvent(new CustomEvent('continueChat', { detail: chat }));\r\n      // also set a fallback in localStorage in case other tab needs it\r\n      localStorage.setItem('continueChat', JSON.stringify(chat));\r\n    } catch (err) {\r\n      console.warn('Unable to dispatch continueChat event, using localStorage fallback', err);\r\n      localStorage.setItem('continueChat', JSON.stringify(chat));\r\n    }\r\n  };\r\n\r\n  // Handle delete chat\r\n  const handleDeleteChat = (id, e) => {\r\n    if (e) e.stopPropagation();\r\n    setShowConfirmDeleteId(id);\r\n  };\r\n\r\n  const confirmDeleteChat = (id) => {\r\n    try {\r\n      remove(ref(db, `chats/${currentUser}/${id}`));\r\n    } catch (err) {\r\n      console.warn('Failed removing chat node:', err);\r\n    }\r\n    try {\r\n      remove(ref(db, `chatHistory/${currentUser}/${id}`));\r\n    } catch (err) {\r\n      // ignore\r\n    }\r\n    if (selectedChat?.id === id) setSelectedChat(null);\r\n    setShowConfirmDeleteId(null);\r\n  };\r\n\r\n  // Handle delete all chats\r\n  const handleDeleteAll = () => {\r\n    if (chatList.length === 0) {\r\n      alert(\"Tidak ada chat untuk dihapus\");\r\n      return;\r\n    }\r\n\r\n    const confirmed = window.confirm(\r\n      `⚠️ PERINGATAN!\\n\\nAnda akan menghapus SEMUA riwayat chat (${chatList.length} percakapan).\\n\\nTindakan ini TIDAK DAPAT dibatalkan!\\n\\nLanjutkan?`\r\n    );\r\n\r\n    if (confirmed) {\r\n      setShowConfirmDeleteAll(true);\r\n    }\r\n  };\r\n\r\n  const confirmDeleteAll = () => {\r\n    setShowConfirmDeleteAll(false);\r\n    // remove everything under chats and chatHistory for this user\r\n    try {\r\n      remove(ref(db, `chats/${currentUser}`));\r\n    } catch (err) {\r\n      console.warn('Failed to remove chats root:', err);\r\n      // fallback: remove one-by-one\r\n      chatList.forEach((chat) => {\r\n        try { remove(ref(db, `chats/${currentUser}/${chat.id}`)); } catch (e) {}\r\n      });\r\n    }\r\n    try {\r\n      remove(ref(db, `chatHistory/${currentUser}`));\r\n    } catch (err) {\r\n      console.warn('Failed to remove chatHistory root:', err);\r\n    }\r\n    setSelectedChat(null);\r\n    alert(\"✅ Semua riwayat chat berhasil dihapus!\");\r\n  };\r\n\r\n  // Handle edit chat title\r\n  const handleEditTitle = (chat) => {\r\n    setEditingChatId(chat.id);\r\n    setEditTitle(chat.title || generateChatTitle(chat));\r\n  };\r\n\r\n  // Save edited title\r\n  const handleSaveTitle = async (chatId) => {\r\n    if (!editTitle.trim()) {\r\n      alert(\"Judul tidak boleh kosong!\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await update(ref(db, `chats/${currentUser}/${chatId}`), {\r\n        title: editTitle.trim(),\r\n      });\r\n      setEditingChatId(null);\r\n    } catch (error) {\r\n      console.error(\"Error updating title:\", error);\r\n      alert(\"Gagal mengubah judul!\");\r\n    }\r\n  };\r\n\r\n  // Generate title from first message\r\n  const generateChatTitle = (chat) => {\r\n    if (chat.messages && chat.messages.length > 0) {\r\n      const firstUserMessage = chat.messages.find((m) => m.sender === \"user\");\r\n      if (firstUserMessage) {\r\n        return firstUserMessage.text.substring(0, 40) + \"...\";\r\n      }\r\n    }\r\n    return \"Percakapan tanpa judul\";\r\n  };\r\n\r\n  // Filter chats\r\n  const filteredChats = chatList.filter((chat) => {\r\n    // Search filter\r\n    const title = chat.title || generateChatTitle(chat);\r\n    const matchSearch = title.toLowerCase().includes(searchTerm.toLowerCase());\r\n\r\n    // Date filter\r\n    let matchDate = true;\r\n    if (filterDate !== \"all\") {\r\n      const chatDate = new Date(chat.date);\r\n      const today = new Date();\r\n      const diffTime = today - chatDate;\r\n      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n      if (filterDate === \"today\") {\r\n        matchDate = diffDays === 0;\r\n      } else if (filterDate === \"week\") {\r\n        matchDate = diffDays <= 7;\r\n      } else if (filterDate === \"month\") {\r\n        matchDate = diffDays <= 30;\r\n      }\r\n    }\r\n\r\n    return matchSearch && matchDate;\r\n  });\r\n\r\n  // Format timestamp\r\n  const formatTimestamp = (timestamp) => {\r\n    if (!timestamp) return \"\";\r\n    const date = new Date(timestamp);\r\n    return date.toLocaleString(\"id-ID\", {\r\n      year: \"numeric\",\r\n      month: \"long\",\r\n      day: \"numeric\",\r\n      hour: \"2-digit\",\r\n      minute: \"2-digit\",\r\n    });\r\n  };\r\n\r\n  // Format relative time\r\n  const formatRelativeTime = (timestamp) => {\r\n    if (!timestamp) return \"\";\r\n    const date = new Date(timestamp);\r\n    const now = new Date();\r\n    const diffTime = now - date;\r\n    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\r\n    const diffHours = Math.floor(diffTime / (1000 * 60 * 60));\r\n    const diffMinutes = Math.floor(diffTime / (1000 * 60));\r\n\r\n    if (diffMinutes < 1) return \"Baru saja\";\r\n    if (diffMinutes < 60) return `${diffMinutes} menit lalu`;\r\n    if (diffHours < 24) return `${diffHours} jam lalu`;\r\n    if (diffDays === 1) return \"Kemarin\";\r\n    if (diffDays < 7) return `${diffDays} hari lalu`;\r\n    return date.toLocaleDateString(\"id-ID\", { day: \"numeric\", month: \"short\" });\r\n  };\r\n\r\n  // Export chat\r\n  const handleExportChat = () => {\r\n    if (!selectedChat) return;\r\n\r\n    const chatText = selectedChat.messages\r\n      .map((msg) => {\r\n        const sender = msg.sender === \"user\" ? \"Anda\" : \"AI Assistant\";\r\n        return `[${sender}]: ${msg.text}`;\r\n      })\r\n      .join(\"\\n\\n\");\r\n\r\n    const blob = new Blob([chatText], { type: \"text/plain\" });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = `chat-${selectedChat.id}.txt`;\r\n    a.click();\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"loading-container\">\r\n        <div className=\"loading-spinner\"></div>\r\n        <p>Memuat riwayat chat...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"riwayat-container\">\r\n      {/* Sidebar - Chat List */}\r\n      <div className=\"chat-sidebar\">\r\n        <div className=\"sidebar-header\">\r\n          <div className=\"header-title\">\r\n            <h2>💬 Riwayat Chat</h2>\r\n            <p className=\"subtitle\">\r\n              {chatList.length} percakapan tersimpan\r\n            </p>\r\n          </div>\r\n          {chatList.length > 0 && (\r\n            <button className=\"btn-delete-all\" onClick={handleDeleteAll} title=\"Hapus semua chat\">\r\n              🗑️\r\n            </button>\r\n          )}\r\n        </div>\r\n\r\n        {/* Search & Filter */}\r\n        <div className=\"sidebar-controls\">\r\n          <div className=\"search-box\">\r\n            <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n              <circle cx=\"11\" cy=\"11\" r=\"8\" />\r\n              <path d=\"m21 21-4.35-4.35\" />\r\n            </svg>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Cari chat...\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n            />\r\n          </div>\r\n\r\n          <select\r\n            className=\"filter-select\"\r\n            value={filterDate}\r\n            onChange={(e) => setFilterDate(e.target.value)}\r\n          >\r\n            <option value=\"all\">Semua Waktu</option>\r\n            <option value=\"today\">Hari Ini</option>\r\n            <option value=\"week\">Minggu Ini</option>\r\n            <option value=\"month\">Bulan Ini</option>\r\n          </select>\r\n        </div>\r\n\r\n        {/* Chat List */}\r\n        <div className=\"chat-list\">\r\n          {filteredChats.length === 0 ? (\r\n            <div className=\"empty-state-sidebar\">\r\n              <div className=\"empty-icon\">📭</div>\r\n              <p>Tidak ada chat ditemukan</p>\r\n            </div>\r\n          ) : (\r\n            filteredChats.map((chat) => (\r\n              <div\r\n                key={chat.id}\r\n                className={`chat-item ${selectedChat?.id === chat.id ? \"active\" : \"\"}`}\r\n                onClick={() => handleSelectChat(chat)}\r\n              >\r\n                <div className=\"chat-icon-wrapper\">\r\n                  <span className=\"chat-icon\">🤖</span>\r\n                </div>\r\n\r\n                <div className=\"chat-info\">\r\n                  {editingChatId === chat.id ? (\r\n                    <input\r\n                      type=\"text\"\r\n                      className=\"edit-title-input\"\r\n                      value={editTitle}\r\n                      onChange={(e) => setEditTitle(e.target.value)}\r\n                      onBlur={() => handleSaveTitle(chat.id)}\r\n                      onKeyDown={(e) => {\r\n                        if (e.key === \"Enter\") handleSaveTitle(chat.id);\r\n                        if (e.key === \"Escape\") setEditingChatId(null);\r\n                      }}\r\n                      autoFocus\r\n                      onClick={(e) => e.stopPropagation()}\r\n                    />\r\n                  ) : (\r\n                    <h4>{chat.title || generateChatTitle(chat)}</h4>\r\n                  )}\r\n                  <p className=\"chat-date\">{formatRelativeTime(chat.date)}</p>\r\n                  <p className=\"chat-preview\">\r\n                    {chat.lastMessage?.substring(0, 50) || \"Tidak ada pesan\"}...\r\n                  </p>\r\n                </div>\r\n\r\n                <div className=\"chat-actions\">\r\n                  <button\r\n                    className=\"action-btn continue\"\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      handleContinueChat(chat);\r\n                    }}\r\n                    title=\"Lanjutkan percakapan\"\r\n                  >\r\n                    ▶️\r\n                  </button>\r\n                  <button\r\n                    className=\"action-btn edit\"\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      handleEditTitle(chat);\r\n                    }}\r\n                    title=\"Edit judul\"\r\n                  >\r\n                    ✏️\r\n                  </button>\r\n                  <button\r\n                    className=\"action-btn delete\"\r\n                    onClick={(e) => handleDeleteChat(chat.id, e)}\r\n                    title=\"Hapus chat\"\r\n                  >\r\n                    🗑️\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main View - Chat Messages */}\r\n      <div className=\"chat-view\">\r\n        {selectedChat ? (\r\n          <>\r\n            <div className=\"chat-view-header\">\r\n              <div className=\"header-info\">\r\n                <h3>{selectedChat.title || generateChatTitle(selectedChat)}</h3>\r\n                <p>{formatTimestamp(selectedChat.date)}</p>\r\n              </div>\r\n              <div className=\"header-actions\">\r\n                <button className=\"btn-export\" onClick={handleExportChat} title=\"Export chat\">\r\n                  📥 Export\r\n                </button>\r\n                <button\r\n                  className=\"btn-delete\"\r\n                  onClick={(e) => handleDeleteChat(selectedChat.id, e)}\r\n                  title=\"Hapus chat\"\r\n                >\r\n                  🗑️ Hapus\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"chat-messages\" ref={chatViewRef}>\r\n              {selectedChat.messages && selectedChat.messages.length > 0 ? (\r\n                selectedChat.messages.map((msg, index) => (\r\n                  <div\r\n                    key={index}\r\n                    className={`message-wrapper ${msg.sender === \"user\" ? \"user\" : \"ai\"}`}\r\n                  >\r\n                    {msg.sender === \"ai\" && (\r\n                      <div className=\"message-avatar\">\r\n                        <div className=\"bot-icon\">🤖</div>\r\n                      </div>\r\n                    )}\r\n\r\n                    <div className=\"message-bubble\">\r\n                      <p className=\"message-text\">\r\n                        {msg.text.split(\"\\n\").map((line, i) => (\r\n                          <React.Fragment key={i}>\r\n                            {line}\r\n                            {i < msg.text.split(\"\\n\").length - 1 && <br />}\r\n                          </React.Fragment>\r\n                        ))}\r\n                      </p>\r\n                      {msg.timestamp && (\r\n                        <span className=\"message-time\">\r\n                          {new Date(msg.timestamp).toLocaleTimeString(\"id-ID\", {\r\n                            hour: \"2-digit\",\r\n                            minute: \"2-digit\",\r\n                          })}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n\r\n                    {msg.sender === \"user\" && (\r\n                      <div className=\"message-avatar user-avatar\">\r\n                        <div className=\"user-icon\">\r\n                          {currentUser.charAt(0).toUpperCase()}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                ))\r\n              ) : (\r\n                <div className=\"empty-messages\">\r\n                  <p>Tidak ada pesan dalam percakapan ini</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </>\r\n        ) : (\r\n          <div className=\"chat-empty\">\r\n            <div className=\"empty-icon-large\">💬</div>\r\n            <h3>Belum ada chat yang dipilih</h3>\r\n            <p>Pilih salah satu percakapan di sebelah kiri untuk melihat isinya</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RiwayatChat;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}